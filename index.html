<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organización 4 Millones - Centro de Socios</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- CSS modular -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
</head>
<body>
    <!-- Loading state -->
    <div id="loading" class="loading-container">
        <div class="loading-spinner large"></div>
        <p>Verificando autenticación...</p>
    </div>

    <!-- Main content (hidden initially) -->
    <div id="main-content" style="display: none;">
        <!-- Contenedor para partículas (se carga dinámicamente) -->
        <div id="particles-container"></div>

        <div class="main-container">
            <!-- Contenedor para sidebar (se carga dinámicamente) -->
            <div id="sidebar-container"></div>

            <main class="content-area">
                <!-- Contenedor para header (se carga dinámicamente) -->
                <div id="header-container"></div>

                <div class="tools-grid">
                    <div class="tool-card">
                        <div class="tool-card-image" style="background-image: url('https://4millones.com/wp-content/uploads/2025/07/gano-cafe-clasico-catalogo-min.png');">
                            <div class="status-badge available">Disponible</div>
                        </div>
                        <div class="tool-card-content">
                            <h3>Catálogo Interactivo</h3>
                            <p>Presenta y comparte fácilmente todo el portafolio de productos con tus clientes para cerrar más ventas. Herramienta optimizada para conversiones.</p>
                            <a href="#" target="_blank" rel="noopener noreferrer" class="btn" id="catalog-btn" data-default="https://catalogo.4millones.com/">
                                Abrir Catálogo
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <div class="tool-card">
                        <div class="tool-card-image" style="background-image: url('https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=1470&auto=format&fit=crop');">
                            <div class="status-badge available">Disponible</div>
                        </div>
                        <div class="tool-card-content">
                            <h3>Modelo de Negocio</h3>
                            <p>La herramienta clave para presentar el modelo de negocio. Expande tu organización invitando nuevos socios y construye un activo empresarial que genere ingresos residuales.</p>
                            <a href="#" target="_blank" rel="noopener noreferrer" class="btn" id="business-btn" data-default="https://oportunidad.4millones.com/">
                                Abrir Presentación
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <div class="tool-card placeholder-card">
                        <div class="tool-card-content">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                <path d="M9 7.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1z"/>
                            </svg>
                            <h3>Agenda de Capacitación</h3>
                            <p>Conéctate a los próximos talleres y capacitaciones de producto y negocio para acelerar tu crecimiento profesional.</p>
                            <span class="coming-soon">Próximamente</span>
                        </div>
                    </div>

                    <div class="tool-card placeholder-card">
                        <div class="tool-card-content">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                            </svg>
                            <h3>Recursos de Marketing</h3>
                            <p>Descarga imágenes, fichas y material de apoyo listos para usar en tus redes sociales y potenciar tus ventas digitales.</p>
                            <span class="coming-soon">Próximamente</span>
                        </div>
                    </div>

                    <div class="tool-card placeholder-card">
                        <div class="tool-card-content">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
                            </svg>
                            <h3>Centro de Soporte</h3>
                            <p>Accede a tutoriales, guías paso a paso y soporte técnico personalizado para maximizar el uso de todas las herramientas.</p>
                            <span class="coming-soon">Próximamente</span>
                        </div>
                    </div>

                    <div class="tool-card placeholder-card">
                        <div class="tool-card-content">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.708 2.825L15 11.105V5.383zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741zM1 11.105l4.708-2.897L1 5.383v5.722z"/>
                            </svg>
                            <h3>Email Marketing</h3>
                            <p>Herramientas de email marketing automatizado para nutrir leads y convertir prospectos en clientes activos.</p>
                            <span class="coming-soon">Próximamente</span>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Error state -->
    <div id="error-content" class="error-container" style="display: none;">
        <h2>Error de Autenticación</h2>
        <p>No se pudo cargar el sistema de autenticación. Por favor, recarga la página.</p>
        <button onclick="window.location.reload()" class="btn">Recargar Página</button>
    </div>

    <!-- Cargar Supabase desde CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- Script principal usando la estructura completa -->
    <script type="module">
        // Importar main.js que maneja toda la lógica
        import { initializeProtectedPage, personalizeToolLinks, getCurrentUser } from './assets/js/main.js';

        // Verificar que Supabase esté cargado
        if (typeof supabase === 'undefined') {
            console.error('Supabase no se pudo cargar');
            document.getElementById('error-content').style.display = 'flex';
        } else {
            // Inicializar página protegida usando main.js
            initializeProtectedPage().then(user => {
                if (user) {
                    // Personalizar enlaces de herramientas
                    personalizeToolLinks(user.id);

                    // Personalizar mensaje de bienvenida
                    const welcomeText = document.getElementById('welcome-text');
                    const mainDescription = document.getElementById('main-description');

                    if (welcomeText && user.full_name) {
                        const firstName = user.full_name.split(' ')[0];
                        welcomeText.textContent = `Bienvenido, ${firstName}`;
                    }

                    if (mainDescription && user.full_name) {
                        const firstName = user.full_name.split(' ')[0];
                        mainDescription.textContent = `${firstName}, aquí tienes tu centro de herramientas premium para construir y acelerar tu activo empresarial con el respaldo de la Organización 4 Millones.`;
                    }

                    console.log('Portal personalizado para:', user.full_name);
                }
            }).catch(error => {
                console.error('Error al inicializar portal:', error);
                document.getElementById('error-content').style.display = 'flex';
            });
        }
    </script>
</body>
</html>
